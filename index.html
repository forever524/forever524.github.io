<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹å¹´çº§è‹±è¯­å…¨å†ŒçŸ¥è¯†å¼ºåŒ–æŠ½æµ‹ã€å­¦ç”Ÿç­”é¢˜ç‰ˆ-å¯æäº¤å®Œæ•´æŠ¥å‘Šã€‘</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Arial", "Microsoft YaHei", sans-serif;
        }
        body {
            background-color: #f5f7fa;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .info-area {
            background-color: #eaf5ff;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px solid #3498db;
        }
        .info-item {
            margin: 12px 0;
            display: flex;
            align-items: center;
        }
        .info-item label {
            font-size: 24px;
            color: #2c3e50;
            font-weight: bold;
            width: 100px;
        }
        .info-item input {
            font-size: 24px;
            padding: 10px 15px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            outline: none;
            flex: 1;
        }
        .info-item input:focus {
            border-color: #3498db;
        }
        h1 {
            font-size: 42px;
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        h2 {
            font-size: 32px;
            color: #34495e;
            margin: 30px 0 20px;
            border-left: 5px solid #3498db;
            padding-left: 15px;
        }
        .module {
            margin-bottom: 50px;
        }
        .btn {
            font-size: 24px;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
            margin: 10px;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .btn:active {
            transform: scale(0.98);
        }
        .btn-green {
            background-color: #27ae60;
        }
        .btn-green:hover {
            background-color: #219653;
        }
        .btn-red {
            background-color: #e74c3c;
        }
        .btn-red:hover {
            background-color: #c0392b;
        }
        .btn-blue-big {
            background-color: #165DFF;
            font-weight: bold;
            font-size: 26px;
            padding: 20px 40px;
            margin: 20px auto;
            display: block;
        }
        .btn-blue-big:hover {
            background-color: #0E42D2;
        }
        .question {
            font-size: 28px;
            margin: 25px 0;
            color: #2c3e50;
            line-height: 1.6;
        }
        .options {
            margin: 30px 0;
        }
        .option {
            font-size: 24px;
            margin: 15px 0;
            padding: 15px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            line-height: 1.5;
        }
        .option:hover {
            background-color: #ecf0f1;
        }
        .option.selected {
            border-color: #3498db;
            background-color: #e3f2fd;
        }
        .input-area {
            margin: 30px 0;
        }
        input[type="text"] {
            font-size: 24px;
            padding: 15px;
            width: 100%;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            margin-bottom: 20px;
            outline: none;
        }
        input[type="text"]:focus {
            border-color: #3498db;
        }
        .feedback {
            font-size: 26px;
            margin: 25px 0;
            padding: 20px;
            border-radius: 8px;
            display: none;
            line-height: 1.6;
        }
        .correct {
            background-color: #e8f5e9;
            color: #27ae60;
        }
        .incorrect {
            background-color: #ffebee;
            color: #e74c3c;
        }
        .score {
            font-size: 32px;
            text-align: center;
            margin: 40px 0;
            color: #2c3e50;
            font-weight: bold;
            line-height: 1.8;
        }
        .error-list {
            margin: 30px 0;
            padding: 20px;
            background-color: #fafafa;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        .error-item {
            font-size: 22px;
            margin: 15px 0;
            color: #2c3e50;
            line-height: 1.6;
            padding-bottom: 15px;
            border-bottom: 1px dashed #ddd;
        }
        .record-area {
            background-color: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 24px;
            color: #2c3e50;
            line-height: 1.8;
        }
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 36px;
            }
            h2 {
                font-size: 28px;
            }
            .info-item label, .info-item input {
                font-size: 20px;
            }
            .btn {
                font-size: 20px;
                padding: 12px 24px;
                display: inline-block;
                margin: 8px 5px;
            }
            .btn-blue-big {
                font-size: 22px;
                padding: 15px 30px;
            }
            .question {
                font-size: 24px;
            }
            .option {
                font-size: 22px;
            }
            input[type="text"] {
                font-size: 22px;
            }
            .feedback {
                font-size: 24px;
            }
            .score {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ä¹å¹´çº§è‹±è¯­å…¨å†ŒçŸ¥è¯†å¼ºåŒ–æŠ½æµ‹</h1>
        
        <!-- å­¦ç”Ÿä¿¡æ¯å¡«å†™åŒº -->
        <div class="info-area">
            <div class="info-item">
                <label>å§“ã€€åï¼š</label>
                <input type="text" id="studentName" placeholder="è¯·è¾“å…¥å§“åï¼ˆå¿…å¡«ï¼‰" autocomplete="off">
            </div>
            <div class="info-item">
                <label>ç­ã€€çº§ï¼š</label>
                <input type="text" id="studentClass" placeholder="è¯·è¾“å…¥ç­çº§ï¼ˆå¿…å¡«ï¼‰ä¾‹ï¼šä¹(1)ç­" autocomplete="off">
            </div>
        </div>

        <!-- è®¡åˆ†é¢æ¿ï¼šç­”é¢˜æ€»æ•°+ç­”å¯¹é¢˜æ•°+æ­£ç¡®ç‡ -->
        <div class="score">
            ç­”é¢˜æ€»æ•°: <span id="total">0</span> &nbsp;&nbsp;
            ç­”å¯¹é¢˜æ•°: <span id="score">0</span> &nbsp;&nbsp;
            æ­£ç¡®ç‡: <span id="rate">0%</span>
        </div>

        <!-- è¯æ±‡åº”ç”¨æ¨¡å— -->
        <div class="module" id="vocab-module">
            <h2>ä¸€ã€è¯æ±‡ç»¼åˆåº”ç”¨æŠ½æµ‹ï¼ˆå•å…ƒé‡ç‚¹+è¯­å¢ƒå˜å½¢ï¼‰</h2>
            <button class="btn" onclick="generateVocabQuestion()">ç”Ÿæˆè¯æ±‡é¢˜ç›®</button>
            <div id="vocab-question-area">
                <div class="question" id="vocab-question"></div>
                <div class="input-area">
                    <input type="text" id="vocab-answer" placeholder="è¯·è¾“å…¥ç­”æ¡ˆï¼ˆæ³¨æ„è¯å½¢å˜åŒ–/å¤§å°å†™ï¼‰">
                </div>
                <button class="btn" onclick="checkVocabAnswer()">æäº¤ç­”æ¡ˆ</button>
                <div class="feedback" id="vocab-feedback"></div>
            </div>
        </div>
        
        <!-- è¯­æ³•åº”ç”¨æ¨¡å— -->
        <div class="module" id="grammar-module">
            <h2>äºŒã€è¯­æ³•ç»¼åˆåº”ç”¨æŠ½æµ‹ï¼ˆè¯­å¢ƒè¾¨æ+ç»¼åˆè¿ç”¨ï¼‰</h2>
            <button class="btn" onclick="generateGrammarQuestion()">ç”Ÿæˆè¯­æ³•é¢˜ç›®</button>
            <div id="grammar-question-area">
                <div class="question" id="grammar-question"></div>
                <div class="options" id="grammar-options"></div>
                <button class="btn" onclick="checkGrammarAnswer()">æäº¤ç­”æ¡ˆ</button>
                <div class="feedback" id="grammar-feedback"></div>
            </div>
        </div>
        
        <!-- å¥å‹è½¬æ¢æ¨¡å— -->
        <div class="module" id="sentence-module">
            <h2>ä¸‰ã€å¥å‹ç»¼åˆè½¬æ¢æŠ½æµ‹ï¼ˆå¤åˆå˜å½¢+ç»¼åˆæ”¹å†™ï¼‰</h2>
            <button class="btn" onclick="generateSentenceQuestion()">ç”Ÿæˆå¥å‹é¢˜ç›®</button>
            <div id="sentence-question-area">
                <div class="question" id="sentence-question"></div>
                <div class="input-area">
                    <input type="text" id="sentence-answer" placeholder="è¯·è¾“å…¥è½¬æ¢åçš„å®Œæ•´å¥å­">
                </div>
                <button class="btn" onclick="checkSentenceAnswer()">æäº¤ç­”æ¡ˆ</button>
                <div class="feedback" id="sentence-feedback"></div>
            </div>
        </div>
        
        <!-- ç­”é¢˜è®°å½•ä¸é”™é¢˜è¯¦æƒ…+ã€å­¦ç”Ÿæäº¤ä¸“ç”¨æŒ‰é’®ã€‘ -->
        <div class="module">
            <h2>å››ã€ç­”é¢˜è®°å½•ä¸æäº¤æŠ¥å‘Šã€åšå®Œå¿…ç‚¹è¿™ä¸ªå‘ç»™è€å¸ˆã€‘</h2>
            <button class="btn" onclick="showErrorList()">æŸ¥çœ‹æˆ‘çš„é”™é¢˜æœ¬</button>
            <!-- æ ¸å¿ƒï¼šå­¦ç”Ÿåšå®Œåç‚¹è¿™ä¸ªæŒ‰é’®ï¼Œç”ŸæˆæŠ¥å‘Šå‘ç»™è€å¸ˆ -->
            <button class="btn btn-blue-big" onclick="exportStudentReport()">ğŸ“Œ ç”Ÿæˆæˆ‘çš„ç­”é¢˜æŠ¥å‘Šã€å‘ç»™è€å¸ˆã€‘</button>
            <button class="btn btn-red" onclick="resetAll()">ğŸ”„ é‡ç½®æ‰€æœ‰è®°å½•ï¼ˆé‡æ–°åšé¢˜ï¼‰</button>
            <div class="error-list" id="error-list"></div>
        </div>
    </div>

    <script>
        // ============ æ ¸å¿ƒé¢˜åº“ äººæ•™ç‰ˆä¹å¹´çº§å…¨ä¸€å†Œ 66é“é«˜é˜¶åº”ç”¨é¢˜ ============
        const vocabQuestions = [
            {question: "Unit1 ç”¨pronounceçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šHis ______ of English words is very standard, so we can understand him easily.", answer: "pronunciation", explanation: "å½¢å®¹è¯æ€§ç‰©ä¸»ä»£è¯Hisåæ¥åè¯å½¢å¼ï¼Œpronounceçš„åè¯æ˜¯pronunciationï¼ˆå‘éŸ³ï¼‰"},
            {question: "Unit1 ç”¨expressçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šShe is too shy to ______ her true feelings in front of strangers.", answer: "express", explanation: "ä¸å®šå¼ç¬¦å·toåæ¥åŠ¨è¯åŸå½¢ï¼Œexpressæ˜¯åŠ¨è¯ï¼ˆè¡¨è¾¾ï¼‰ï¼Œå›ºå®šæ­é…express one's feelings"},
            {question: "Unit2 ç”¨strangeçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šHe has a ______ hobby of collecting old stamps, and everyone thinks it's special.", answer: "strange", explanation: "ä¿®é¥°åè¯hobbyç”¨å½¢å®¹è¯ï¼Œstrangeï¼ˆå¥‡æ€ªçš„ï¼Œå¥‡ç‰¹çš„ï¼‰è´´åˆè¯­å¢ƒ"},
            {question: "Unit2 ç”¨deadçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šHis grandfather has been ______ for ten years, but he still misses him very much.", answer: "dead", explanation: "å’Œæ—¶é—´æ®µè¿ç”¨ç”¨å»¶ç»­æ€§å½¢å®¹è¯deadï¼Œdieæ˜¯ç¬é—´åŠ¨è¯ä¸èƒ½æ¥for+æ—¶é—´æ®µ"},
            {question: "Unit3 ç”¨politeçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šIt's ______ to cut in line when people are waiting for the bus in public places.", answer: "impolite", explanation: "æ ¹æ®å¥æ„å¡«åä¹‰è¯ï¼Œpoliteçš„å¦å®šå½¢å¼impoliteï¼ˆä¸ç¤¼è²Œçš„ï¼‰ï¼Œç¬¦åˆè¯­å¢ƒé€»è¾‘"},
            {question: "Unit3 ç”¨speakçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šThe girl can ______ three languages fluently, so she wants to be a translator.", answer: "speak", explanation: "æƒ…æ€åŠ¨è¯canåæ¥åŠ¨è¯åŸå½¢ï¼Œspeak+è¯­è¨€æ˜¯å›ºå®šæ­é…"},
            {question: "Unit4 ç”¨silentçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šHe sat ______ in the corner and didn't say a word because he was upset.", answer: "silently", explanation: "ä¿®é¥°åŠ¨è¯satç”¨å‰¯è¯å½¢å¼ï¼Œsilentçš„å‰¯è¯æ˜¯silentlyï¼ˆæ²‰é»˜åœ°ï¼‰"},
            {question: "Unit4 ç”¨proudçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šHer parents take great ______ in her success in the English competition.", answer: "pride", explanation: "å›ºå®šçŸ­è¯­take pride in = be proud of æ„ä¸ºâ€œä¸ºâ€¦â€¦æ„Ÿåˆ°è‡ªè±ªâ€"},
            {question: "Unit5 ç”¨produceçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šThis factory ______ thousands of cars every month and sells them all over the country.", answer: "produces", explanation: "every monthè¡¨ä¸€èˆ¬ç°åœ¨æ—¶ï¼Œä¸»è¯­factoryæ˜¯å•æ•°ï¼ŒåŠ¨è¯ç”¨ç¬¬ä¸‰äººç§°å•æ•°produces"},
            {question: "Unit5 ç”¨localçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šWe should support ______ businesses to help our hometown develop better.", answer: "local", explanation: "ä¿®é¥°åè¯businessesç”¨å½¢å®¹è¯localï¼ˆå½“åœ°çš„ï¼‰ï¼Œå›ºå®šæ­é…local businesses"},
            {question: "Unit6 ç”¨inventçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šEdison is one of the greatest ______ in the world, he invented more than 1000 things.", answer: "inventors", explanation: "one of+å½¢å®¹è¯æœ€é«˜çº§+å¯æ•°åè¯å¤æ•°ï¼Œinventçš„åè¯inventorï¼ˆå‘æ˜å®¶ï¼‰"},
            {question: "Unit6 ç”¨translateçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šThis book has been ______ into more than 20 languages since it came out.", answer: "translated", explanation: "è¢«åŠ¨è¯­æ€ç»“æ„be+è¿‡å»åˆ†è¯ï¼Œtranslateçš„è¿‡å»åˆ†è¯æ˜¯translated"},
            {question: "Unit7 ç”¨allowçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šTeenagers should be ______ to choose their own hobbies by their parents.", answer: "allowed", explanation: "æƒ…æ€åŠ¨è¯çš„è¢«åŠ¨è¯­æ€ï¼šshould be + è¿‡å»åˆ†è¯ï¼Œallowçš„è¿‡å»åˆ†è¯allowed"},
            {question: "Unit7 ç”¨safeçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šFor children, ______ is the most important thing when they go out alone.", answer: "safety", explanation: "ä¸»è¯­ä½ç½®ç”¨åè¯å½¢å¼ï¼Œsafeçš„åè¯æ˜¯safetyï¼ˆå®‰å…¨ï¼‰"},
            {question: "Unit8 ç”¨valueçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šThis old photo is very ______ to me, it's a memory of my childhood.", answer: "valuable", explanation: "beåŠ¨è¯åæ¥å½¢å®¹è¯ä½œè¡¨è¯­ï¼Œvalueçš„å½¢å®¹è¯valuableï¼ˆçè´µçš„ï¼‰"},
            {question: "Unit8 ç”¨sleepçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šDon't make noise, there is a ______ baby in the next room.", answer: "sleeping", explanation: "ä¿®é¥°åè¯babyç”¨ç°åœ¨åˆ†è¯ä½œå®šè¯­ï¼Œsleepingï¼ˆæ­£åœ¨ç¡è§‰çš„ï¼‰"},
            {question: "Unit9 ç”¨preferçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šShe ______ listening to soft music to loud rock music because it makes her relaxed.", answer: "prefers", explanation: "å›ºå®šæ­é…prefer doing A to doing Bï¼Œä¸»è¯­sheæ˜¯ç¬¬ä¸‰äººç§°å•æ•°ï¼Œç”¨prefers"},
            {question: "Unit9 ç”¨senseçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šThe music that has strong ______ of rhythm is always popular with young people.", answer: "sense", explanation: "å›ºå®šçŸ­è¯­a sense of rhythmï¼ˆèŠ‚å¥æ„Ÿï¼‰ï¼Œstrongä¿®é¥°åè¯sense"},
            {question: "Unit10 ç”¨customçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šIt's a ______ in Japan to bow to show respect when you meet someone for the first time.", answer: "custom", explanation: "ä¸å®šå† è¯aåæ¥å•æ•°åè¯ï¼Œcustomï¼ˆä¹ ä¿—ï¼Œé£ä¿—ï¼‰"},
            {question: "Unit10 ç”¨greetçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šHe went up to ______ the foreign guests with a big smile on his face.", answer: "greet", explanation: "ä¸å®šå¼ç¬¦å·toåæ¥åŠ¨è¯åŸå½¢ï¼Œgreetï¼ˆé—®å€™ï¼Œè¿æ¥ï¼‰"},
            {question: "Unit11 ç”¨influenceçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šGood friends can ______ our moods and make us feel happy every day.", answer: "influence", explanation: "æƒ…æ€åŠ¨è¯canåæ¥åŠ¨è¯åŸå½¢ï¼Œinfluenceï¼ˆå½±å“ï¼‰"},
            {question: "Unit11 ç”¨sadçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šThe sad movie made all of us feel deep ______ for the main character.", answer: "sadness", explanation: "å½¢å®¹è¯deepåæ¥åè¯ï¼Œsadçš„åè¯sadnessï¼ˆæ‚²ä¼¤ï¼‰"},
            {question: "Unit12 ç”¨missçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šHe hurried to the station, but he still ______ the early train this morning.", answer: "missed", explanation: "this morningè¡¨ä¸€èˆ¬è¿‡å»æ—¶ï¼Œmissçš„è¿‡å»å¼missedï¼ˆé”™è¿‡ï¼‰"},
            {question: "Unit12 ç”¨realizeçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šWhen he ______ his mistake, he apologized to his teacher at once.", answer: "realized", explanation: "ååŠå¥ç”¨è¿‡å»å¼ï¼Œå‰åŠå¥æ—¶æ€ä¸€è‡´ï¼Œrealizeçš„è¿‡å»å¼realized"},
            {question: "Unit13 ç”¨polluteçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šWe must take action to stop ______ the river, or the fish will all die.", answer: "polluting", explanation: "å›ºå®šæ­é…stop doing sth åœæ­¢åšæŸäº‹ï¼Œpolluteçš„åŠ¨åè¯polluting"},
            {question: "Unit13 ç”¨harmçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šEating too much junk food is ______ to our health in the long run.", answer: "harmful", explanation: "å›ºå®šçŸ­è¯­be harmful to = do harm to å¯¹â€¦â€¦æœ‰å®³"},
            {question: "Unit14 ç”¨reviewçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šBefore the final exam, we need ______ all the key points we learned this term.", answer: "to review", explanation: "å›ºå®šæ­é…need to do sth éœ€è¦åšæŸäº‹ï¼Œreviewï¼ˆå¤ä¹ ï¼‰"},
            {question: "Unit14 ç”¨overcomeçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šShe has ______ many difficulties in her study and made great progress.", answer: "overcome", explanation: "ç°åœ¨å®Œæˆæ—¶have/has+è¿‡å»åˆ†è¯ï¼Œovercomeçš„è¿‡å»åˆ†è¯è¿˜æ˜¯overcome"},
            {question: "Unit4 æ‹“å±•ï¼šç”¨requireçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šThis job ______ a lot of patience and experience, not everyone can do it well.", answer: "requires", explanation: "ä¸»è¯­jobæ˜¯å•æ•°ï¼Œä¸€èˆ¬ç°åœ¨æ—¶åŠ¨è¯ç”¨ç¬¬ä¸‰äººç§°å•æ•°requiresï¼ˆéœ€è¦ï¼‰"},
            {question: "Unit7 æ‹“å±•ï¼šç”¨decideçš„é€‚å½“å½¢å¼å¡«ç©ºï¼šAfter a long discussion, they finally made a ______ to travel to Beijing this summer.", answer: "decision", explanation: "å›ºå®šæ­é…make a decision åšå†³å®šï¼Œdecideçš„åè¯å½¢å¼decision"}
        ];

        const grammarQuestions = [
            {question: "Unit1 è¯­æ³•ï¼š______ you read English aloud every morning, your pronunciation will become better and better.", options: ["Unless", "If", "Though", "Because"], answer: "If", explanation: "è€ƒæŸ¥æ¡ä»¶çŠ¶è¯­ä»å¥ï¼Œifå¼•å¯¼æ¡ä»¶å¥è¡¨â€œå¦‚æœâ€ï¼Œä¸»å¥ç”¨å°†æ¥æ—¶ï¼Œä»å¥ç”¨ä¸€èˆ¬ç°åœ¨æ—¶"},
            {question: "Unit2 è¯­æ³•ï¼šThe lanterns ______ by hand in China for thousands of years and they are still popular now.", options: ["make", "are made", "have been made", "were made"], answer: "have been made", explanation: "for+æ—¶é—´æ®µè¡¨ç°åœ¨å®Œæˆæ—¶ï¼Œä¸»è¯­lanternså’Œmakeæ˜¯è¢«åŠ¨å…³ç³»ï¼Œç”¨ç°åœ¨å®Œæˆæ—¶è¢«åŠ¨è¯­æ€"},
            {question: "Unit3 è¯­æ³•ï¼šCould you tell me ______ I can get to the nearest bookstore? I want to buy an English dictionary.", options: ["how", "what", "where", "who"], answer: "how", explanation: "è€ƒæŸ¥å®¾è¯­ä»å¥çš„è¿æ¥è¯ï¼Œè¯¢é—®æ–¹å¼ç”¨howï¼Œå®¾è¯­ä»å¥ç”¨é™ˆè¿°è¯­åº"},
            {question: "Unit4 è¯­æ³•ï¼šShe ______ short hair, but now her hair is long and curly. She has changed a lot.", options: ["used to have", "is used to have", "used to having", "is used to having"], answer: "used to have", explanation: "used to do è¡¨â€œè¿‡å»å¸¸å¸¸åšæŸäº‹â€ï¼Œbe used to doing è¡¨â€œä¹ æƒ¯äºåšæŸäº‹â€ï¼Œç»“åˆè¯­å¢ƒé€‰å‰è€…"},
            {question: "Unit5 è¯­æ³•ï¼šThis kind of pen ______ bamboo, and it ______ in Zhejiang Province.", options: ["is made of; is made", "is made from; is made", "is made of; is made in", "is made from; is made in"], answer: "is made of; is made in", explanation: "çœ‹å¾—è§åŸææ–™ç”¨be made ofï¼Œè¡¨äº§åœ°ç”¨be made inï¼Œç«¹å­åšçš„ç¬”èƒ½çœ‹è§åŸææ–™"},
            {question: "Unit6 è¯­æ³•ï¼šThe light bulb ______ by Edison in 1879, and it has changed people's life greatly since then.", options: ["invents", "invented", "is invented", "was invented"], answer: "was invented", explanation: "in 1879è¡¨ä¸€èˆ¬è¿‡å»æ—¶ï¼Œä¸»è¯­å’Œinventæ˜¯è¢«åŠ¨å…³ç³»ï¼Œç”¨ä¸€èˆ¬è¿‡å»æ—¶è¢«åŠ¨è¯­æ€"},
            {question: "Unit7 è¯­æ³•ï¼šTeenagers ______ to smoke or drink wine in China, it's against the rules and bad for health.", options: ["should allow", "shouldn't allow", "should be allowed", "shouldn't be allowed"], answer: "shouldn't be allowed", explanation: "æƒ…æ€åŠ¨è¯çš„è¢«åŠ¨è¯­æ€å¦å®šå½¢å¼ï¼Œç»“åˆè¯­å¢ƒâ€œé’å°‘å¹´ä¸åº”è¯¥è¢«å…è®¸æŠ½çƒŸå–é…’â€"},
            {question: "Unit8 è¯­æ³•ï¼šThe notebook ______ be Li Ming's, his name is written on the cover of it.", options: ["must", "could", "might", "can't"], answer: "must", explanation: "æƒ…æ€åŠ¨è¯è¡¨è‚¯å®šæ¨æµ‹ï¼Œæœ‰ç¡®å‡¿è¯æ®ï¼ˆåå­—åœ¨ä¸Šé¢ï¼‰ç”¨mustï¼Œå¯èƒ½æ€§100%"},
            {question: "Unit8 è¯­æ³•ï¼šThis story ______ be true, no one has seen such a strange thing before.", options: ["must", "could", "might", "can't"], answer: "can't", explanation: "æƒ…æ€åŠ¨è¯è¡¨å¦å®šæ¨æµ‹ï¼Œè¯­æ°”æœ€å¼ºç”¨can'tï¼Œå¯èƒ½æ€§0%"},
            {question: "Unit9 è¯­æ³•ï¼šI like music ______ I can sing along with, because it's easy for me to remember the lyrics.", options: ["who", "that", "what", "whose"], answer: "that", explanation: "è€ƒæŸ¥å®šè¯­ä»å¥ï¼Œå…ˆè¡Œè¯musicæ˜¯ç‰©ï¼Œä»å¥ä¸­ç¼ºå®¾è¯­ï¼Œç”¨that/whichå¼•å¯¼"},
            {question: "Unit9 è¯­æ³•ï¼šThe man ______ is standing over there is our new English teacher, he comes from America.", options: ["who", "which", "whose", "whom"], answer: "who", explanation: "å…ˆè¡Œè¯manæ˜¯äººï¼Œä»å¥ä¸­ç¼ºä¸»è¯­ï¼Œç”¨whoå¼•å¯¼å®šè¯­ä»å¥"},
            {question: "Unit10 è¯­æ³•ï¼šYou ______ shake hands with him when you meet a Chinese friend for the first time, it's a common custom.", options: ["should", "mustn't", "can't", "needn't"], answer: "should", explanation: "æƒ…æ€åŠ¨è¯è¡¨å»ºè®®ï¼Œshouldï¼ˆåº”è¯¥ï¼‰è´´åˆâ€œä¹ ä¿—å»ºè®®â€çš„è¯­å¢ƒ"},
            {question: "Unit11 è¯­æ³•ï¼šThe movie was so sad that it made all of us ______ in the cinema yesterday.", options: ["cry", "to cry", "crying", "cried"], answer: "cry", explanation: "ä½¿å½¹åŠ¨è¯makeçš„å›ºå®šç”¨æ³•ï¼šmake sb do sth è®©æŸäººåšæŸäº‹ï¼Œåæ¥åŠ¨è¯åŸå½¢"},
            {question: "Unit12 è¯­æ³•ï¼šBy the time we got to the cinema, the movie ______ for ten minutes already.", options: ["began", "has begun", "had been on", "was on"], answer: "had been on", explanation: "by the time+ä¸€èˆ¬è¿‡å»æ—¶ï¼Œä¸»å¥ç”¨è¿‡å»å®Œæˆæ—¶ï¼›beginæ˜¯ç¬é—´åŠ¨è¯ï¼Œæ¥æ—¶é—´æ®µç”¨be on"},
            {question: "Unit13 è¯­æ³•ï¼šWe should try our best ______ plastic bags to protect the environment around us.", options: ["to reduce using", "reduce to use", "reducing using", "to reduce to use"], answer: "to reduce using", explanation: "å›ºå®šæ­é…try one's best to do sth å’Œ reduce doing sth åŒé‡è€ƒç‚¹"},
            {question: "Unit14 è¯­æ³•ï¼šWe ______ English for six years since we came to middle school, and we can speak it well now.", options: ["learn", "learned", "have learned", "will learn"], answer: "have learned", explanation: "since+ä¸€èˆ¬è¿‡å»æ—¶ï¼Œä¸»å¥ç”¨ç°åœ¨å®Œæˆæ—¶ï¼Œè¡¨åŠ¨ä½œä»è¿‡å»æŒç»­åˆ°ç°åœ¨"},
            {question: "ç»¼åˆè¯­æ³•ï¼š______ he is very young, he knows a lot about English grammar and culture.", options: ["Because", "Although", "If", "When"], answer: "Although", explanation: "è€ƒæŸ¥è®©æ­¥çŠ¶è¯­ä»å¥ï¼Œalthoughè¡¨â€œè™½ç„¶â€ï¼Œä¸èƒ½å’Œbutè¿ç”¨ï¼Œè´´åˆè¯­å¢ƒé€»è¾‘"},
            {question: "ç»¼åˆè¯­æ³•ï¼šShe asked me ______ I would go to the English party with her or not this weekend.", options: ["that", "if", "whether", "what"], answer: "whether", explanation: "å®¾è¯­ä»å¥ä¸­ï¼Œå’Œor notè¿ç”¨åªèƒ½ç”¨whetherï¼Œä¸èƒ½ç”¨if"}
        ];

        const sentenceQuestions = [
            {question: "Unit1 å¥å‹è½¬æ¢ï¼šI learn English by taking notes in class. (å¯¹åˆ’çº¿éƒ¨åˆ†æé—®) â†’ ______ ______ you learn English?", answer: "How do", explanation: "å¯¹æ–¹å¼çŠ¶è¯­æé—®ç”¨howï¼Œä¸€èˆ¬ç°åœ¨æ—¶ä¸»è¯­youç”¨åŠ©åŠ¨è¯do"},
            {question: "Unit2 å¥å‹è½¬æ¢ï¼šPeople celebrate the Spring Festival in China every year. (æ”¹ä¸ºè¢«åŠ¨è¯­æ€) â†’ The Spring Festival ______ ______ in China every year.", answer: "is celebrated", explanation: "ä¸€èˆ¬ç°åœ¨æ—¶è¢«åŠ¨è¯­æ€ï¼šam/is/are + è¿‡å»åˆ†è¯ï¼Œä¸»è¯­æ˜¯å•æ•°ç”¨is"},
            {question: "Unit3 å¥å‹è½¬æ¢ï¼šWhere can I buy a map of China? Could you tell me? (åˆå¹¶ä¸ºå®¾è¯­ä»å¥) â†’ Could you tell me ______ ______ ______ buy a map of China?", answer: "where I can", explanation: "å®¾è¯­ä»å¥ç”¨é™ˆè¿°è¯­åºï¼Œç–‘é—®è¯+ä¸»è¯­+è°“è¯­ï¼Œæ—¶æ€ä¸å˜"},
            {question: "Unit4 å¥å‹è½¬æ¢ï¼šHe used to be afraid of speaking in public. (æ”¹ä¸ºå¦å®šå¥) â†’ He ______ ______ ______ be afraid of speaking in public.", answer: "didn't use to", explanation: "used toçš„å¦å®šå½¢å¼æœ‰ä¸¤ç§ï¼šdidn't use to / used not toï¼Œå‰è€…æ›´å¸¸ç”¨"},
            {question: "Unit5 å¥å‹è½¬æ¢ï¼šThey make this kind of toy in Shanghai. (æ”¹ä¸ºè¢«åŠ¨è¯­æ€å¹¶æ‹“å±•) â†’ This kind of toy ______ ______ ______ in Shanghai.", answer: "is made by them", explanation: "è¢«åŠ¨è¯­æ€è¡¥å……åŠ¨ä½œæ‰§è¡Œè€…by sbï¼Œä¸€èˆ¬ç°åœ¨æ—¶å•æ•°ä¸»è¯­ç”¨is made"},
            {question: "Unit6 å¥å‹è½¬æ¢ï¼šEdison invented the light bulb in 1879. (æ”¹ä¸ºè¢«åŠ¨è¯­æ€) â†’ The light bulb ______ ______ by Edison in 1879.", answer: "was invented", explanation: "ä¸€èˆ¬è¿‡å»æ—¶è¢«åŠ¨è¯­æ€ï¼šwas/were + è¿‡å»åˆ†è¯ï¼Œå•æ•°ä¸»è¯­ç”¨was"},
            {question: "Unit7 å¥å‹è½¬æ¢ï¼šWe should allow students to choose their own clothes. (æ”¹ä¸ºè¢«åŠ¨è¯­æ€) â†’ Students ______ ______ ______ to choose their own clothes.", answer: "should be allowed", explanation: "æƒ…æ€åŠ¨è¯çš„è¢«åŠ¨è¯­æ€ï¼šæƒ…æ€åŠ¨è¯ + be + è¿‡å»åˆ†è¯"},
            {question: "Unit8 å¥å‹è½¬æ¢ï¼šThis schoolbag must belong to Lucy. (æ”¹ä¸ºåŒä¹‰å¥) â†’ This schoolbag ______ ______ Lucy's.", answer: "must be", explanation: "must belong to sb = must be sb's æƒ…æ€åŠ¨è¯è¡¨æ¨æµ‹çš„åŒä¹‰è½¬æ¢"},
            {question: "Unit9 å¥å‹è½¬æ¢ï¼šI like music that is quiet and gentle. (æ”¹ä¸ºåŒä¹‰å¥) â†’ I like ______ ______ music.", answer: "quiet and gentle", explanation: "å®šè¯­ä»å¥ç®€åŒ–ä¸ºå½¢å®¹è¯ä½œå®šè¯­ï¼Œä¿®é¥°åè¯music"},
            {question: "Unit10 å¥å‹è½¬æ¢ï¼šYou should bow when you meet a Japanese friend. (æ”¹ä¸ºåŒä¹‰å¥) â†’ You ______ ______ bow when you meet a Japanese friend.", answer: "are supposed to", explanation: "æƒ…æ€åŠ¨è¯è¡¨å»ºè®®ï¼šshould = be supposed to æ ¸å¿ƒåŒä¹‰è½¬æ¢"},
            {question: "Unit11 å¥å‹è½¬æ¢ï¼šThe sad story made her cry. (æ”¹ä¸ºè¢«åŠ¨è¯­æ€) â†’ She ______ ______ ______ cry by the sad story.", answer: "was made to", explanation: "ä½¿å½¹åŠ¨è¯makeçš„è¢«åŠ¨è¯­æ€è¦è¿˜åŸtoï¼Œç»“æ„ï¼šbe made to do sth"},
            {question: "Unit12 å¥å‹è½¬æ¢ï¼šI got up late, so I missed the early bus. (æ”¹ä¸ºåŒä¹‰å¥) â†’ I missed the early bus ______ I got up late.", answer: "because", explanation: "soè¡¨ç»“æœï¼Œbecauseè¡¨åŸå› ï¼Œå‰åå¥é€»è¾‘è½¬æ¢"},
            {question: "Unit13 å¥å‹è½¬æ¢ï¼šWe must stop cutting down trees to protect the earth. (æ”¹ä¸ºåŒä¹‰å¥) â†’ We must ______ ______ cutting down trees to protect the earth.", answer: "give up", explanation: "stop doing sth = give up doing sth åœæ­¢/æ”¾å¼ƒåšæŸäº‹ï¼Œæ ¸å¿ƒçŸ­è¯­è½¬æ¢"},
            {question: "Unit14 å¥å‹è½¬æ¢ï¼šWe have learned English for six years. (æ”¹ä¸ºåŒä¹‰å¥) â†’ We ______ ______ English six years ago.", answer: "began to learn", explanation: "for+æ—¶é—´æ®µï¼ˆç°åœ¨å®Œæˆæ—¶ï¼‰å’Œago+æ—¶é—´ç‚¹ï¼ˆä¸€èˆ¬è¿‡å»æ—¶ï¼‰çš„æ—¶æ€è½¬æ¢"},
            {question: "ç»¼åˆå¥å‹ï¼šThe park is very beautiful. (æ”¹ä¸ºæ„Ÿå¹å¥) â†’ ______ ______ the park is!", answer: "How beautiful", explanation: "æ„Ÿå¹å½¢å®¹è¯ç”¨ï¼šHow + å½¢å®¹è¯ + ä¸»è¯­ + è°“è¯­"},
            {question: "ç»¼åˆå¥å‹ï¼šHe can speak English very well. He can also speak French very well. (åˆå¹¶ä¸ºä¸€å¥) â†’ He can speak ______ English ______ French very well.", answer: "both and", explanation: "both...and...è¡¨â€œä¸¤è€…éƒ½â€ï¼Œè¿æ¥å¹¶åˆ—åè¯ï¼Œè´´åˆè¯­å¢ƒ"},
            {question: "ç»¼åˆå¥å‹ï¼šShe is too young to go to school alone. (æ”¹ä¸ºåŒä¹‰å¥) â†’ She is ______ young ______ she can't go to school alone.", answer: "so that", explanation: "too...to... = so...that+å¦å®šå¥ æ ¸å¿ƒå¥å‹è½¬æ¢ï¼Œé”»ç‚¼å¥å¼å˜é€š"},
            {question: "ç»¼åˆå¥å‹ï¼šI think English grammar is very difficult. (æ”¹ä¸ºå¦å®šå¥) â†’ I ______ ______ English grammar ______ very difficult.", answer: "don't think is", explanation: "å®¾è¯­ä»å¥çš„å¦å®šå‰ç§»ï¼Œä¸»è¯­æ˜¯ç¬¬ä¸€äººç§°æ—¶ï¼Œå¦å®šè¯æ”¾åœ¨ä¸»å¥è°“è¯­ä¸Š"}
        ];

        // å…¨å±€å˜é‡
        let currentVocabIndex = -1;
        let currentGrammarIndex = -1;
        let currentSentenceIndex = -1;
        let score = 0;
        let totalQuestions = 0;
        let errorList = [];

        // è¯æ±‡æ¨¡å—å‡½æ•°
        function generateVocabQuestion() {
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * vocabQuestions.length);
            } while (randomIndex === currentVocabIndex && vocabQuestions.length > 1);
            currentVocabIndex = randomIndex;
            
            const question = vocabQuestions[randomIndex];
            document.getElementById("vocab-question").textContent = question.question;
            document.getElementById("vocab-answer").value = "";
            document.getElementById("vocab-feedback").style.display = "none";
        }

        function checkVocabAnswer() {
            const userAnswer = document.getElementById("vocab-answer").value.trim().toLowerCase();
            const correctAnswer = vocabQuestions[currentVocabIndex].answer.toLowerCase();
            const feedback = document.getElementById("vocab-feedback");
            
            totalQuestions++;
            if (userAnswer === correctAnswer) {
                score++;
                feedback.className = "feedback correct";
                feedback.innerHTML = `æ­£ç¡®ï¼ğŸ‰ ${vocabQuestions[currentVocabIndex].explanation}`;
            } else {
                feedback.className = "feedback incorrect";
                feedback.innerHTML = `é”™è¯¯ï¼âŒ æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${vocabQuestions[currentVocabIndex].answer} ${vocabQuestions[currentVocabIndex].explanation}`;
                errorList.push({type: "è¯æ±‡åº”ç”¨", question: vocabQuestions[currentVocabIndex].question, userAnswer: userAnswer, correctAnswer: vocabQuestions[currentVocabIndex].answer, analysis: vocabQuestions[currentVocabIndex].explanation});
            }
            feedback.style.display = "block";
            updateScore();
        }

        // è¯­æ³•æ¨¡å—å‡½æ•°
        function generateGrammarQuestion() {
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * grammarQuestions.length);
            } while (randomIndex === currentGrammarIndex && grammarQuestions.length > 1);
            currentGrammarIndex = randomIndex;
            
            const question = grammarQuestions[randomIndex];
            document.getElementById("grammar-question").textContent = question.question;
            
            const optionsContainer = document.getElementById("grammar-options");
            optionsContainer.innerHTML = "";
            question.options.forEach((option, index) => {
                const optionElement = document.createElement("div");
                optionElement.className = "option";
                optionElement.textContent = `${String.fromCharCode(65 + index)}. ${option}`;
                optionElement.dataset.answer = option;
                optionElement.onclick = function() {
                    document.querySelectorAll(".option").forEach(opt => opt.classList.remove("selected"));
                    this.classList.add("selected");
                };
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById("grammar-feedback").style.display = "none";
        }

        function checkGrammarAnswer() {
            const selectedOption = document.querySelector(".option.selected");
            const feedback = document.getElementById("grammar-feedback");
            
            if (!selectedOption) {
                feedback.className = "feedback incorrect";
                feedback.innerHTML = "è¯·é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆåå†æäº¤ï¼";
                feedback.style.display = "block";
                return;
            }
            
            totalQuestions++;
            const userAnswer = selectedOption.dataset.answer;
            const correctAnswer = grammarQuestions[currentGrammarIndex].answer;
            
            if (userAnswer === correctAnswer) {
                score++;
                feedback.className = "feedback correct";
                feedback.innerHTML = `æ­£ç¡®ï¼ğŸ‰ ${grammarQuestions[currentGrammarIndex].explanation}`;
            } else {
                feedback.className = "feedback incorrect";
                feedback.innerHTML = `é”™è¯¯ï¼âŒ æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${correctAnswer} ${grammarQuestions[currentGrammarIndex].explanation}`;
                errorList.push({type: "è¯­æ³•åº”ç”¨", question: grammarQuestions[currentGrammarIndex].question, userAnswer: userAnswer, correctAnswer: correctAnswer, analysis: grammarQuestions[currentGrammarIndex].explanation});
            }
            feedback.style.display = "block";
            updateScore();
        }

        // å¥å‹æ¨¡å—å‡½æ•°
        function generateSentenceQuestion() {
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * sentenceQuestions.length);
            } while (randomIndex === currentSentenceIndex && sentenceQuestions.length > 1);
            currentSentenceIndex = randomIndex;
            
            const question = sentenceQuestions[randomIndex];
            document.getElementById("sentence-question").textContent = question.question;
            document.getElementById("sentence-answer").value = "";
            document.getElementById("sentence-feedback").style.display = "none";
        }

        function checkSentenceAnswer() {
            const userAnswer = document.getElementById("sentence-answer").value.trim().toLowerCase();
            const correctAnswer = sentenceQuestions[currentSentenceIndex].answer.toLowerCase();
            const feedback = document.getElementById("sentence-feedback");
            
            totalQuestions++;
            const isCorrect = userAnswer === correctAnswer;
            if (isCorrect) {
                score++;
                feedback.className = "feedback correct";
                feedback.innerHTML = `æ­£ç¡®ï¼ğŸ‰ ${sentenceQuestions[currentSentenceIndex].explanation}`;
            } else {
                feedback.className = "feedback incorrect";
                feedback.innerHTML = `é”™è¯¯ï¼âŒ æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${sentenceQuestions[currentSentenceIndex].answer} ${sentenceQuestions[currentSentenceIndex].explanation}`;
                errorList.push({type: "å¥å‹è½¬æ¢", question: sentenceQuestions[currentSentenceIndex].question, userAnswer: userAnswer, correctAnswer: correctAnswer, analysis: sentenceQuestions[currentSentenceIndex].explanation});
            }
            feedback.style.display = "block";
            updateScore();
        }

        // æ›´æ–°è®¡åˆ†é¢æ¿
        function updateScore() {
            document.getElementById("score").textContent = score;
            document.getElementById("total").textContent = totalQuestions;
            let rate = totalQuestions === 0 ? 0 : Math.round((score / totalQuestions) * 100);
            document.getElementById("rate").textContent = rate + "%";
        }

        // æŸ¥çœ‹é”™é¢˜æœ¬
        function showErrorList() {
            const errorContainer = document.getElementById("error-list");
            const stuName = document.getElementById("studentName").value || "æœªå¡«å†™";
            const stuClass = document.getElementById("studentClass").value || "æœªå¡«å†™";

            if (errorList.length === 0) {
                errorContainer.innerHTML = `<div class="error-item">âœ… å­¦ç”Ÿï¼š${stuName} | ç­çº§ï¼š${stuClass} <br>å¤ªæ£’äº†ï¼æš‚æ— é”™é¢˜ï¼Œç»§ç»­ä¿æŒä¼˜ç§€çš„çŠ¶æ€ï½</div>`;
                return;
            }
            
            let errorHTML = `<div class="error-item"><strong>ğŸ“‹ ç­”é¢˜ä¿¡æ¯ï¼š${stuName} | ${stuClass} | ç­”é¢˜æ€»æ•°ï¼š${totalQuestions} | ç­”å¯¹ï¼š${score} | æ­£ç¡®ç‡ï¼š${Math.round((score / totalQuestions)*100)}%</strong></div>`;
            errorList.forEach((error, index) => {
                errorHTML += `
                    <div class="error-item">
                        <strong>${index + 1}. ${error.type}</strong><br>
                        é¢˜ç›®ï¼š${error.question}<br>
                        ä½ çš„ç­”æ¡ˆï¼š${error.userAnswer || "æœªä½œç­”"}<br>
                        æ­£ç¡®ç­”æ¡ˆï¼š${error.correctAnswer}<br>
                        è§£æï¼š${error.analysis}
                    </div>
                `;
            });
            errorContainer.innerHTML = errorHTML;
        }

        // ============ æ ¸å¿ƒä¿®å¤ï¼šé£ä¹¦APIé…ç½®+æ¥å£ä¿®å¤+å­—æ®µåŒ¹é… ============
        const FEISHU_CONFIG = {
            APP_ID: "cli_a9eba3180578dbb5",
            APP_SECRET: "NKrjzYr55FzQxqBpVaUkHgbVVP41oXro",
            APP_TOKEN: "GrkybwmxHagRWzsDtVbchEIknAc",
            TABLE_ID: "tbltzBXsWJku41bz"
        };

        // è·å–é£ä¹¦APIè°ƒç”¨å‡­è¯
        async function getFeishuToken() {
            const res = await fetch("https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    app_id: FEISHU_CONFIG.APP_ID,
                    app_secret: FEISHU_CONFIG.APP_SECRET
                })
            });
            const data = await res.json();
            return data.tenant_access_token;
        }

        // âœ… ä¿®å¤æ ¸å¿ƒï¼šæ¥å£åœ°å€ bitable â†’ base æ–°æ¥å£
        async function writeToFeishuTable(token, submitData) {
            const res = await fetch(`https://open.feishu.cn/open-apis/base/v1/apps/${FEISHU_CONFIG.APP_TOKEN}/tables/${FEISHU_CONFIG.TABLE_ID}/records`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${token}`
                },
                body: JSON.stringify({ records: [submitData] })
            });
            return await res.json();
        }

        // âœ… ä¿®å¤æ ¸å¿ƒï¼šå­—æ®µå ç­”å¯¹é¢˜æ•° â†’ å’Œè¡¨æ ¼åˆ—åå®Œå…¨åŒ¹é…
        async function exportStudentReport() {
            const stuName = document.getElementById("studentName").value.trim();
            const stuClass = document.getElementById("studentClass").value.trim();
            
            // å¿…å¡«é¡¹æ ¡éªŒ
            if(!stuName){
                alert("âš ï¸ è¯·å…ˆå¡«å†™ã€å§“åã€‘åå†æäº¤æŠ¥å‘Šå“¦ï¼");
                return;
            }
            if(!stuClass){
                alert("âš ï¸ è¯·å…ˆå¡«å†™ã€ç­çº§ã€‘åå†æäº¤æŠ¥å‘Šå“¦ï¼");
                return;
            }
            if(totalQuestions === 0){
                if(!confirm("âš ï¸ ä½ è¿˜æœªä½œç­”ä»»ä½•é¢˜ç›®ï¼Œæ˜¯å¦ç»§ç»­æäº¤ç©ºæŠ¥å‘Šï¼Ÿ")) return;
            }

            // æ•´ç†æ‰€æœ‰ç­”é¢˜æ•°æ®ï¼ˆå’Œé£ä¹¦è¡¨æ ¼åˆ—å100%å¯¹åº”ï¼‰
            let rate = totalQuestions === 0 ? 0 : Math.round((score / totalQuestions) * 100);
            let errorCount = errorList.length;
            let createTime = new Date().toLocaleString();
            let errorDetail = errorList.length>0 ? errorList.map(item=>`ã€${item.type}ã€‘${item.question} ä½ çš„ç­”æ¡ˆ:${item.userAnswer || "æœªä½œç­”"} æ­£ç¡®ç­”æ¡ˆ:${item.correctAnswer} è§£æ:${item.analysis}`).join("ï¼›") : "æœ¬æ¬¡ç­”é¢˜æš‚æ— é”™é¢˜";

            // æ„é€ é£ä¹¦è¡¨æ ¼éœ€è¦çš„æ•°æ®æ ¼å¼
            const submitData = {
                fields: {
                    "å§“å": stuName,
                    "ç­çº§": stuClass,
                    "ç­”é¢˜æ€»æ•°": totalQuestions,
                    "ç­”å¯¹é¢˜æ•°": score, // âœ… ä¿®å¤ï¼šå’Œè¡¨æ ¼åˆ—åå®Œå…¨ä¸€è‡´
                    "æ­£ç¡®ç‡": `${rate}%`,
                    "é”™é¢˜æ•°é‡": errorCount,
                    "é”™é¢˜è¯¦æƒ…": errorDetail,
                    "æäº¤æ—¶é—´": createTime
                }
            };

            try {
                alert("â³ æ­£åœ¨æäº¤ä½ çš„ç­”é¢˜æŠ¥å‘Šåˆ°è€å¸ˆåå°ï¼Œè¯·ç¨å€™...");
                // 1.è·å–å‡­è¯ 2.å†™å…¥æ•°æ®
                const token = await getFeishuToken();
                const result = await writeToFeishuTable(token, submitData);
                
                // æäº¤æˆåŠŸ/å¤±è´¥æç¤º
                if(result.code === 0){
                    alert(`âœ… æäº¤æˆåŠŸï¼ğŸ‰
ğŸ“Œ å­¦ç”Ÿï¼š${stuName} | ç­çº§ï¼š${stuClass}
ğŸ“Œ ç­”é¢˜æ€»æ•°ï¼š${totalQuestions} é“ | ç­”å¯¹ï¼š${score} é“ | æ­£ç¡®ç‡ï¼š${rate}%
ğŸ“Œ é”™é¢˜æ•°é‡ï¼š${errorCount} é“
âœ… ä½ çš„ç­”é¢˜æŠ¥å‘Šå·²è‡ªåŠ¨å‘é€åˆ°è€å¸ˆçš„é£ä¹¦è¡¨æ ¼ï¼Œæ— éœ€å†åšå…¶ä»–æ“ä½œï¼`);
                }else{
                    alert(`âŒ æäº¤å¤±è´¥ï¼é”™è¯¯ç ï¼š${result.code}
åŸå› ï¼š${result.msg}
ğŸ’¡ è¯·é‡è¯•ä¸€æ¬¡ï¼Œè‹¥ä»å¤±è´¥è¯·è”ç³»è€å¸ˆ`);
                }
            } catch (err) {
                alert(`âŒ æäº¤å‡ºé”™ï¼è¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•ï¼Œé”™è¯¯ä¿¡æ¯ï¼š${err.message}`);
            }
        }

        // é‡ç½®æ‰€æœ‰è®°å½•
        function resetAll() {
            if(confirm("âš ï¸ æ˜¯å¦ç¡®è®¤é‡ç½®æ‰€æœ‰æ•°æ®ï¼Ÿ\nå°†æ¸…ç©ºå§“åç­çº§ã€ç­”é¢˜è®°å½•ã€å¾—åˆ†ã€é”™é¢˜æœ¬ï¼Œå¯é‡æ–°åšé¢˜")){
                score = 0;
                totalQuestions = 0;
                errorList = [];
                currentVocabIndex = -1;
                currentGrammarIndex = -1;
                currentSentenceIndex = -1;
                document.getElementById("studentName").value = "";
                document.getElementById("studentClass").value = "";
                document.getElementById("vocab-answer").value = "";
                document.getElementById("sentence-answer").value = "";
                document.getElementById("vocab-feedback").style.display = "none";
                document.getElementById("grammar-feedback").style.display = "none";
                document.getElementById("sentence-feedback").style.display = "none";
                document.getElementById("error-list").innerHTML = "";
                updateScore();
                generateVocabQuestion();
                generateGrammarQuestion();
                generateSentenceQuestion();
            }
        }

        // é¡µé¢åˆå§‹åŒ–
        window.onload = function() {
            generateVocabQuestion();
            generateGrammarQuestion();
            generateSentenceQuestion();
        };
    </script>
</body>
</html>
